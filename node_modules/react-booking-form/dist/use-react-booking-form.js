import{useCallback as l,useMemo as x,useState as T,createRef as V}from"react";const G=a=>a.reduce((o,u)=>o+u.value,0),C=a=>{const o=Object.keys(a).find(i=>a[i].type==="location"),u=Object.keys(a).find(i=>i!==o&&a[i].type==="location");return!o||!u?null:[o,u]},w=({formSchema:a})=>{const[o,u]=T(()=>{const t={};return Object.keys(a).forEach(e=>{const n=a[e];t[e]={type:n.type,value:n.defaultValue,totalCount:n.type==="peopleCount"?G(n.defaultValue):void 0}}),t}),i=x(()=>Object.keys(a).reduce((t,e)=>(t[e]=V(),t),{}),[]),f=l(t=>{var n,s,r,c,y,p;if(!t)return;const e=o[t].type;if(e==="date"){let d=(n=i[t].current)==null?void 0:n.querySelector("[data-input]");(d==null?void 0:d.getAttribute("type"))==="hidden"&&(d=(s=i[t].current)==null?void 0:s.querySelector(".form-control.input")),d==null||d.focus();return}if(e==="location")return(c=(r=i[t].current)==null?void 0:r.focus)==null?void 0:c.call(r);(p=(y=i[t].current)==null?void 0:y.click)==null||p.call(y)},[i]),v=l((t,e)=>{u(n=>({...n,[t]:{...n[t],value:e}}))},[]),g=l((t,e)=>{u(n=>({...n,[t]:{...n[t],...e}}))},[]),m=l((t,e,n)=>{const s=[...o[t].value],r=s.findIndex(c=>e.name===c.name);s[r].value=n,g(t,{value:s,totalCount:G(s)})},[o]),O=l((t,e)=>()=>{m(e,t,t.value-1)},[m]),F=l((t,e)=>()=>{m(e,t,t.value+1)},[m]),b=l((t,e)=>e==="plus"?t.value>=(t.max||100):t.value===0,[]),S=l(t=>{const e=(t==null?void 0:t.length)===2?t:C(o);!e||(g(e[0],o[e[1]]),g(e[1],o[e[0]]))},[o]),k=l(({convertDate:t})=>{const e={};return Object.keys(o).forEach(n=>{var c,y;const s=o[n];let r="";if(s.type==="date"){const p=(c=s.value)==null?void 0:c[0];r=t?t(p):p}if(s.type==="peopleCount"){s.value.forEach(p=>{e[`${n}-${p.name}`]=p.value});return}s.type==="location"&&(r=(y=s.value)==null?void 0:y.value),e[n]=r}),new URLSearchParams(e).toString()},[o]);return x(()=>({formSchema:a,state:o,setState:u,setFieldValue:v,setFieldState:g,refs:i,focusOn:f,setGuestOptionValue:m,onMinusClick:O,onPlusClick:F,getIsOptionDisabled:b,swapLocations:S,serializeToURLParams:k}),[a,o,u,i,v,f,g,O,F,b,S,k])};export{w as useReactBookingForm};
