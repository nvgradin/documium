import t,{useEffect as H,useRef as w}from"react";import{Combobox as c,Portal as V}from"@headlessui/react";import{useLocationData as j}from"./use-location-data";import{useSelectPopper as q}from"./use-select-popper";const z=t.forwardRef(({active:o,selected:y,Option:b,onClick:C=void 0,form:r,element:s,name:p,option:u,...l},O)=>t.createElement(b,{$active:o,$selected:y,onClick:()=>{var f;r.setFieldState(p,{value:u}),(f=s==null?void 0:s.focus)==null||f.call(s),setTimeout(()=>{const g=r.formSchema[p].focusOnNext;r.focusOn(g)},100)},ref:O,...l},u.label)),Y=({form:o,menu:y,menuContainer:b,option:C,inputComponent:r,emptyOption:s,debounceDelay:p=500,selectOnClick:u=!0,name:l,formatResults:O,autoComplete:T="off",placeholder:f,offset:g,portal:h})=>{var E;const k=(E=o==null?void 0:o.state)==null?void 0:E[l],{element:a,setElement:v,setPopper:F,styles:L,attributes:$}=q({offset:g}),m=w(null),{loadOptions:P,isLoading:B,options:x}=j({debounceDelay:p,formatResults:O,name:l,form:o}),I=n=>{P.current(n.target.value)},N=n=>{o.setFieldState(l,{value:n}),setTimeout(()=>{var d,S;const e=o.formSchema[l].focusOnNext;if(!e)return;if(o.formSchema[e].type==="location")return(S=(d=o.refs[e])==null?void 0:d.current)==null?void 0:S.focus();o.focusOn(e)},50)},M=()=>{var n,e,i;(e=(n=m==null?void 0:m.current)==null?void 0:n.click)==null||e.call(n),u&&((i=a==null?void 0:a.select)==null||i.call(a))};H(()=>{o.refs[l].current=a},[a]);const D=h||V;return t.createElement(c,{value:k.value,onChange:N},({open:n})=>t.createElement(t.Fragment,null,t.createElement(c.Button,{style:{display:"none"},ref:m}),t.createElement(c.Input,{onFocus:M,displayValue:e=>e==null?void 0:e.label,onChange:I,ref:v,isLoading:B,as:r,placeholder:f,autoComplete:T,name:l,form:o}),t.createElement(D,null,t.createElement(c.Options,{as:b,ref:F,static:!0,style:{...L.popper,pointerEvents:n?"":"none"},...$.popper},t.createElement(y,{open:n},!x.length&&(typeof s=="function"?s():t.createElement(C,{$disabled:!0},s)),x.map(e=>t.createElement(c.Option,{key:e.value,value:e,as:t.Fragment},({active:i,selected:d})=>t.createElement(z,{active:i,selected:d,option:e,Option:C,form:o,element:a,name:l},e.label))))))))};export{Y as LocationSelect};
